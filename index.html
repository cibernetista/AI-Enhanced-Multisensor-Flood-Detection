<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Flood Risk Dashboard</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin=""/>
  <link rel="stylesheet" href="./ css/style.css"> 
</head>
<body class="app-bg">
  <header>
    <div class="wrap">
      <div class="title">Flood Risk Dashboard</div>
      <span class="badge">Beta</span>
      <div class="grow"></div>
      <input id="from" class="input" type="date" title="Fecha de inicio"/>
      <span style="color:var(--muted)">→</span>
      <input id="to" class="input" type="date" title="Fecha de fin"/>
      <select id="aoi" title="Área de Interés">
        <option value="Default">Default (Todas las AOI)</option>
        </select>
      <button id="refresh" class="btn primary">Actualizar</button>
      <label class="switch"><input id="live" type="checkbox" checked/> Live</label>
      <button id="settingsBtn" class="btn ghost">Config</button>
    </div>
  </header>

  <main>
    <section>
      <div class="card" style="position:relative;overflow:hidden">
        <h3>Mapa de Eventos de Inundación</h3>
        <div class="content" style="padding:0">
          <div id="map">
             <div class="legend" id="mapLegend">
                <div style="font-weight:600;margin-bottom:6px">Severidad</div>
                <div><span class="dot" style="background:var(--accent-1);opacity:.6"></span> Alto</div>
                <div><span class="dot" style="background:var(--accent-2);opacity:.6"></span> Medio</div>
                <div><span class="dot" style="background:var(--accent-3);opacity:.6"></span> Bajo</div>
             </div>
          </div>
        </div>
      </div>

      <div class="card" style="margin-top:24px">
        <h3>Lluvia & Riesgo de Inundación (14 días)</h3>
        <div class="content">
          <canvas id="tsChart" height="180"></canvas>
        </div>
      </div>
    </section>

    <aside class="right-panel">
      <div class="card">
        <h3>Indicadores Clave de Impacto (KPIs)</h3>
        <div class="content">
          <div class="kpis">
            <div class="kpi" aria-label="Área total inundada">
              <div class="muted">Área inundada (Total)</div>
              <div id="kpiArea" class="big" style="color:var(--accent-1)">—</div>
            </div>
            <div class="kpi" aria-label="Población total afectada">
              <div class="muted">Población afectada</div>
              <div id="kpiPeople" class="big" style="color:var(--brand)">—</div>
            </div>
            <div class="kpi" aria-label="Conteo de alertas por severidad: Alto, Medio, Bajo">
              <div class="muted">Alertas (A/M/B)</div>
              <div id="kpiCounts" class="big">—</div>
            </div>
          </div>
          <div class="muted" style="margin-top:12px;font-size:12px">Última actualización: <span id="lastUpdate">—</span> <button id="exportCsv" class="btn ghost" style="padding:4px 8px;margin-left:8px">Exportar CSV</button></div>
        </div>
      </div>

      <div class="card" style="margin-top:24px">
        <h3>Notificaciones Recientes</h3>
        <div id="notifList" class="content" style="display:grid;gap:4px"></div>
      </div>
    </aside>

    <section style="grid-column:1/-1">
      <div class="card">
        <h3>Detalle de Alertas Detectadas</h3>
        <div class="content" style="overflow-x:auto">
          <table>
            <thead>
              <tr>
                <th>ID</th><th>Fecha/Hora</th><th>AOI</th><th>Severidad</th><th>Área (km²)</th><th>Población</th><th>Acciones</th>
              </tr>
            </thead>
            <tbody id="alertsTable"></tbody>
          </table>
        </div>
      </div>
    </section>
  </main>

  <dialog id="settings">
    <form method="dialog" class="content" id="settingsForm">
      <h3 style="border:none;padding:0;margin:0 0 10px 0">Configuración del Panel</h3>
      <label style="display:block;font-size:12px;color:var(--muted)">Endpoint de alertas</label>
      <input id="endpoint" name="endpoint" class="input" placeholder="https://api.tu-backend/alerts" value="/api/alerts"/>
      <label style="display:block;margin-top:12px;font-size:12px;color:var(--muted)">Token de Autorización</label>
      <input id="token" name="token" class="input" placeholder="Bearer …"/>
      <label style="display:block;margin-top:12px;font-size:12px;color:var(--muted)">Umbral Mínimo para Alerta **Media** (km²)</label>
      <input id="thr" name="thresholdKm2" class="input" type="number" value="50" min="1" />
      <p style="font-size:12px;color:var(--muted);margin-top:12px">Este valor define la severidad. Área $\ge$ Umbral = **Medio**. Área $\ge 2\times$ Umbral = **Alto**.</p>
      <div style="display:flex;justify-content:flex-end;gap:8px;margin-top:16px">
        <button type="submit" class="btn primary">Guardar y Cerrar</button>
      </div>
    </form>
  </dialog>

  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="./src/script.js"></script>
</body>
</html>